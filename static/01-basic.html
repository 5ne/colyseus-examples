<!DOCTYPE html>
<html>
  <head>
    <style>
      body { font-family: Tahoma, Geneva, sans-serif; text-align: center; }
    </style>

    <!-- dummy Symbol polyfill -->
    <script>if (typeof(Symbol)==="undefined") { window.Symbol = function(arg) { return arg; } }</script>

    <!-- colyseus.js client (npm run bundle-colyseus-client) -->
    <script type="text/javascript" src="colyseus.js"></script>

  </head>
  <body>
    <h1><img src="https://rawgit.com/gamestdio/colyseus/master/media/header.png" height="100" alt="colyseus"></h1>
    <strong>Messages</strong><br>

    <form id="form">
      <input type="text" id="input" value="" />
      <input type="submit" value="send" />
    </form>

    <div id="messages"></div>

    <script>
      var host = window.document.location.host.replace(/:.*/, '');

      var client = new Colyseus.Client(location.protocol.replace("http", "ws") + host + (location.port ? ':'+location.port : ''));

      var chatRoom_2 = client.join("chat_2");;
      chatRoom_2.onJoin.add(function () {
        console.log("joined chat_2");
      });

      chatRoom_2.onUpdate.addOnce(function(state) {
        console.log("initial room data:", state);
      });

      // new room state
      chatRoom_2.onUpdate.add(function(state) {
        // this signal is triggered on each patch
      });

      chatRoom_2.listen("players/current", function(change) {
        console.log(change);
      });

      // listen to patches coming from the server
      chatRoom_2.listen("messages/:number", function(change) {
        var p = document.createElement("p");
        p.innerHTML = change.value;
        document.querySelector("#messages").appendChild(p);
      });

      chatRoom_2.listen(function(change) {
        console.log("patch:", change.path, change.operation, change.value)
      });

      var chatRoom = client.join("chat");
      chatRoom.onJoin.add(function () {
        console.log("joined chat");
      });

      chatRoom.onUpdate.addOnce(function(state) {
        console.log("initial room data:", state);
      });

      // new room state
      chatRoom.onUpdate.add(function(state) {
        // this signal is triggered on each patch
      });

      chatRoom.listen("players/current", function(change) {
        console.log(change);
      });

      // listen to patches coming from the server
      chatRoom.listen("messages/:number", function(change) {
        var p = document.createElement("p");
        p.innerHTML = change.value;
        document.querySelector("#messages").appendChild(p);
      });

      chatRoom.listen(function(change) {
        console.log("patch:", change.path, change.operation, change.value)
      });

      // send data to room on submit
      document.querySelector("#form").onsubmit = function(e) {
        e.preventDefault();

        var input = document.querySelector("#input");

        console.log("input:", input.value);

        // send data to room
        chatRoom.send({ message: input.value });
        chatRoom_2.send({ message: input.value });

        // clear input
        input.value = "";
      }

    </script>
  </body>
</html>
